<div class="dashboard-container" *ngIf="!loading">
    <!-- Navbar -->
    <nav class="navbar">
        <div class="logo">TimeClock App</div>
        <div class="user-info">
            <span>Welcome, {{ data?.firstName }} {{ data?.lastName }}</span>
            <button (click)="logout()" class="logout-btn">Logout</button>
        </div>
    </nav>

    <div class="main-content">
        <!-- Controls -->
        <div class="controls-bar">
            <button (click)="changeWeek(-1)" class="nav-btn">&larr; Previous Week</button>
            <span class="week-display">Week of {{ data?.weekSelect | date:'mediumDate' }}</span>
            <button (click)="changeWeek(1)" class="nav-btn">Next Week &rarr;</button>
        </div>

        <!-- Summary Card -->
        <div class="action-panel">
            <div class="summary-card">
                <h3>Weekly Summary</h3>
                <div class="summary-row">
                    <span>Day Entries:</span>
                    <span>{{ (data?.dayEntryTotalHours || 0) | number:'1.2-2' }} hrs</span>
                </div>
                <div class="summary-row">
                    <span>Task Entries:</span>
                    <span>{{ (data?.taskEntryTotalHours || 0) | number:'1.2-2' }} hrs</span>
                </div>
                <div class="summary-row">
                    <span>Leave Entries:</span>
                    <span>{{ (data?.leaveEntryTotalHours || 0) | number:'1.2-2' }} hrs</span>
                </div>
            </div>
        </div>

        <!-- Day Entries Component -->
        <app-day-entries 
            [dayEntries]="data?.dayEntries || []"
            [userId]="userId"
            (refresh)="loadDashboard()">
        </app-day-entries>

        <!-- Task Entries Component -->
        <app-task-entries 
            [taskEntries]="data?.taskEntries || []"
            [jobs]="data?.jobs || []"
            [tasks]="data?.tasks || []"
            [userId]="userId"
            (refresh)="loadDashboard()">
        </app-task-entries>

        <!-- Leave Entries Component -->
        <app-leave-entries 
            [leaveEntries]="data?.leaveEntries || []"
            [userId]="userId"
            (refresh)="loadDashboard()">
        </app-leave-entries>

    </div>

    <!-- Job & Task Management -->
    <div class="management-section" *ngIf="data?.isAdmin">
        <div class="management-card">
            <div class="section-header">
                <h3>Manage Jobs</h3>
                <button (click)="toggleAddJobForm()" class="add-btn">
                    {{ showAddJobForm ? 'Cancel' : '+ New Job' }}
                </button>
            </div>
            <div *ngIf="showAddJobForm" class="add-form">
                <div class="form-row">
                    <div class="form-group">
                        <label>Job Number</label>
                        <input type="text" [(ngModel)]="newJob.jobNumber" placeholder="e.g., 1234">
                    </div>
                    <div class="form-group">
                        <label>Job Name</label>
                        <input type="text" [(ngModel)]="newJob.jobName" placeholder="e.g., Warehouse Upgrade">
                    </div>
                    <button (click)="createJob()" class="save-btn">Save Job</button>
                </div>
            </div>
            <!-- Jobs List -->
            <div class="items-list">
                <div *ngFor="let job of data?.jobs" class="list-item">
                    <span class="item-text">{{ job.jobNumber }} - {{ job.jobName }}</span>
                    <button class="icon-btn delete-btn" title="Delete" aria-label="Delete" (click)="deleteJob(job.id)">&times;</button>
                </div>
                <div *ngIf="!data?.jobs?.length" class="no-data">No jobs available.</div>
            </div>
        </div>
        <div class="management-card">
            <div class="section-header">
                <h3>Manage Tasks</h3>
                <button (click)="toggleAddTaskForm()" class="add-btn">
                    {{ showAddTaskForm ? 'Cancel' : '+ New Task' }}
                </button>
            </div>
            <div *ngIf="showAddTaskForm" class="add-form">
                <div class="form-row">
                    <div class="form-group">
                        <label>Task Description</label>
                        <input type="text" [(ngModel)]="newTask.taskDescription" placeholder="e.g., Material Pickup">
                    </div>
                    <button (click)="createTask()" class="save-btn">Save Task</button>
                </div>
            </div>
            <!-- Tasks List -->
            <div class="items-list">
                <div *ngFor="let task of data?.tasks" class="list-item">
                    <span class="item-text">{{ task.taskDescription }}</span>
                    <button class="icon-btn delete-btn" title="Delete" aria-label="Delete" (click)="deleteTask(task.id)">&times;</button>
                </div>
                <div *ngIf="!data?.tasks?.length" class="no-data">No tasks available.</div>
            </div>
        </div>
        <div class="management-card export-card">
            <div class="section-header">
                <h3>Export Time Sheet</h3>
            </div>
            <div class="form-group">
                <label>Select Group</label>
                <select [(ngModel)]="exportForm.group">
                    <option value="" disabled>Select group</option>
                    <option *ngFor="let group of data?.groups" [ngValue]="group">{{ group }}</option>
                </select>
            </div>
            <div class="form-group">
                <label>From</label>
                <input type="date" [(ngModel)]="exportForm.fromDate">
            </div>
            <div class="form-group">
                <label>To</label>
                <input type="date" [(ngModel)]="exportForm.toDate">
            </div>
            <button (click)="exportTimeSheet()" class="add-btn full-width" [disabled]="exporting">
                {{ exporting ? 'Exporting...' : 'Export All Selected' }}
            </button>
        </div>
    </div>
</div>

<div *ngIf="loading" class="loading-overlay">
    <div class="spinner"></div>
</div>
